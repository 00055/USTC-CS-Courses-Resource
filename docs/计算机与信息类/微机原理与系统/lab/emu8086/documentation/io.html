<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">









  
  
  <link rel="stylesheet" media="all" href="/lib/Han/dist/han.min.css?v=3.3">




<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.4.2" rel="stylesheet" type="text/css">



  <link rel="icon" type="image/png" sizes="32x32" href="/yinyang.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/yinyang.png?v=6.4.2">










<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.4.2',
    sidebar: {"position":"left","width":350,"display":"always","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="I/O ports and Hardware Interrupts                I/O ports and Hardware Interrupts        The emulator does not reproduce any input/output devices of the original IBM PC &amp;reg;, however theoretic">
<meta property="og:type" content="website">
<meta property="og:title" content="mbinary&#39;s blog">
<meta property="og:url" content="https://mbinary.coding.me/ustc-cs/计算机与信息类/微机原理与系统/lab/emu8086/documentation/io.html">
<meta property="og:site_name" content="mbinary&#39;s blog">
<meta property="og:description" content="I/O ports and Hardware Interrupts                I/O ports and Hardware Interrupts        The emulator does not reproduce any input/output devices of the original IBM PC &amp;reg;, however theoretic">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://mbinary.coding.me/ustc-cs/计算机与信息类/微机原理与系统/lab/emu8086/documentation/img/traffic.gif">
<meta property="og:image" content="https://mbinary.coding.me/ustc-cs/计算机与信息类/微机原理与系统/lab/emu8086/documentation/img/stepper.gif">
<meta property="og:image" content="https://mbinary.coding.me/ustc-cs/计算机与信息类/微机原理与系统/lab/emu8086/documentation/img/robot.gif">
<meta property="og:updated_time" content="2008-09-14T02:00:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="mbinary&#39;s blog">
<meta name="twitter:description" content="I/O ports and Hardware Interrupts                I/O ports and Hardware Interrupts        The emulator does not reproduce any input/output devices of the original IBM PC &amp;reg;, however theoretic">
<meta name="twitter:image" content="https://mbinary.coding.me/ustc-cs/计算机与信息类/微机原理与系统/lab/emu8086/documentation/img/traffic.gif">



  <link rel="alternate" href="/atom.xml" title="mbinary's blog" type="application/atom+xml" />




  <link rel="canonical" href="https://mbinary.coding.me/ustc-cs/计算机与信息类/微机原理与系统/lab/emu8086/documentation/io.html"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title> | mbinary's blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta custom-logo">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">mbinary's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类<span class="badge">15</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签云<span class="badge">47</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />时间轴<span class="badge">39</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-leetcode">
    <a href="/leetcode/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-line-chart"></i> <br />leetcode</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-ustc-cs menu-item-active">
    <a href="/ustc-cs/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />CS课程资源</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="我来帮你找( •̀ ω •́ )✧" spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

    
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
    

  


          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    
    
    
    <div class="post-block page">
      <header class="post-header">

<h2 class="post-title" itemprop="name headline"></h2>

<div class="post-meta">
  
  


  
  
  <ul class="breadcrumb">
    
      
      
        
          <li><a href="/ustc-cs/">USTC-CS</a></li>
          
            
          
        
      
    
      
      
        
          <li><a href="/ustc-cs/计算机与信息类/">计算机与信息类</a></li>
          
            
          
        
      
    
      
      
        
          <li><a href="/ustc-cs/计算机与信息类/微机原理与系统/">微机原理与系统</a></li>
          
            
          
        
      
    
      
      
        
          <li><a href="/ustc-cs/计算机与信息类/微机原理与系统/lab/">LAB</a></li>
          
            
          
        
      
    
      
      
        
          <li><a href="/ustc-cs/计算机与信息类/微机原理与系统/lab/emu8086/">EMU8086</a></li>
          
            
          
        
      
    
      
      
        
          <li>DOCUMENTATION</li>
        
      
    
      
      
        
          <li><a href="/ustc-cs/计算机与信息类/微机原理与系统/lab/emu8086/io.html/">IO.HTML</a></li>
          
            
          
        
      
    
  </ul>


</div>

</header>

      
      
      
      <div class="post-body han-init-context">
        
        
          <script src="/assets/js/APlayer.min.js"> </script>
<html>

<head><meta name="generator" content="Hexo 3.8.0">

<!-- hexo-inject:begin --><!-- hexo-inject:end --><title>I/O ports and Hardware Interrupts</title>

<meta name="description" content="the emulation of i/o ports and hardware interrupts"><!-- hexo-inject:begin --><!-- hexo-inject:end -->



</head>

<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#0000FF" alink="#FF0000">


<!-- hexo-inject:begin --><!-- hexo-inject:end --><!--- insert -->

<font face="Verdana" size="3">

<font size="+2">
<b>I/O ports and Hardware Interrupts</b>
</font>

<br><br>

<br>


The emulator does not reproduce any input/output devices of the original IBM PC &reg;, however theoretically it may be possible to create emulation of the original ibm pc devices. emu8086 supports user-created virtual devices that can be accessed from assembly language program using <b>in</b> and <b>out</b> instructions.
devices that can be created by anyone with basic programming experience in any high or low level programming language.
the simplest virtual device in assembly language can be found in examples: <b>simplest.asm</b>
<br><br>


<hr>

<br>
<b>Input / Output ports</b>
<br><br>


emu8086 supports additional devices that can be created by anyone with basic programming experience in any language
device can be written in any language, such as: java, visual basic,
vc++, delphi, c#, .net or in any other programming language that allow to directly read and write files.
for more information and sample source code look inside this folder: <b>c:\emu8086\DEVICES\DEVELOPER\</b>

<br><br>

The latest version of the emulator has no reserved or fixed I/O ports, input / output addresses for custom
devices are from <b>0000 to 0FFFFh</b> (0 to 65535), but it is important that two devices that use the same ports do not run simultaneously to avoid hardware conflict.

<br><br>


Port <font face="fixedsys">100</font> corresponds to byte <font face="fixedsys">100</font> in this file: <b>c:\emu8086.io</b>
, port <font face="fixedsys">0</font> to byte <font face="fixedsys">0</font>, port <font face="fixedsys">101</font> to byte <font face="fixedsys">101</font>, etc...<br>


<br><br>











<hr>
<br>
<b>Emulation of Hardware Interrupts</b>


<br><br>



  External hardware interrupts can be triggered by external peripheral devices and
  microcontrollers or by the 8087 mathematical coprocessor.


<br><br>

Hardware interrupts are disabled when interrupt flag (IF) is set to 0. when interrupt flag is set to 1,
the emulator continually checks first 256 bytes of this file <b>c:\emu8086.hw</b>
if any of the bytes is none-zero the microprocessor transfers control
to an interrupt handler that matches the triggering byte offset in <b>emu8086.hw</b> file <nobr>(0 to 255)</nobr>
according to the interrupt vector table <nobr>(memory 0000-0400h)</nobr> and resets the byte in <b>emu8086.hw</b> to 00.


<br><br>

These instructions can be used to disable and enable hardware interrupts:

<br><br>
<b>cli</b> - clear interrupt flag (disable hardware interrupts).
<br>
<b>sti</b> - set interrupt flag (enable hardware interrupts).

<br><br>
by default hardware interrupts are enabled and are disabled automatically when software or hardware interrupt is in the middle of the execution.


























<hr>
<br>
<b>Examples of Custom I/O Devices</b>

<br><br>
Ready devices are available from <b>virtual devices</b> menu of the emulator.

<br><br>

<ul>

<li><b>Traffic Lights</b> - port 4 (word)<br><br>
the traffic lights are controlled by sending data to i/o port 4.<br>
there are 12 lamps: 4 green, 4 yellow, and 4 red.<br><br>

you can set the state of each lamp by setting its bit:<br><br>
<b>1</b> - the lamp is turned on.<br>
<b>0</b> - the lamp is turned off.<br><br>

only 12 low bits of a word are used (0 to 11), last bits (12 to 15) are unused.<br><br>

for example:<br><br>
<font face="Fixedsys">
MOV AX, 0000001011110100b<br>
OUT 4, AX<br><br>
</font>

<img src="img/traffic.gif">

<br><br>
we use yellow hexadecimal digits in caption (to achieve compact view), here's a conversion:<br>
<pre><font face="Fixedsys">Hex - Decimal

A   -   10
B   -   11
C   -   12    (unused)
D   -   13    (unused)
E   -   14    (unused)
F   -   15    (unused)</font></pre><br>


first operand for <b>OUT</b> instruction is a port number (<b>4</b>), second operand
is a word (<b>AX</b>) that is written to the port. first operand must be an immediate byte
value (0..255) or <b>DX</b> register. second operand must be <b>AX</b> or <b>AL</b> only.

<br><br>

see also <b>traffic_lights.asm</b> in c:\emu8086\examples.

<br><br>

<hr>

<br>
if required you can read the data from port using <b>IN</b> instruction, for example:<br>
<br>
<font face="Fixedsys">
IN AX, 4<br><br>
</font>

first operand of <b>IN</b> instruction (<b>AX</b>) receives the value from port,
second operand (<b>4</b>) is a port number. first operand must be <b>AX</b> or <b>AL</b> only.
second operand must be an immediate byte value (0..255) or <b>DX</b> register.
<br><br>
<hr>
<br><br>
</li>


<li><b>Stepper Motor</b> - port 7 (byte)<br><br>
the stepper motor is controlled by sending data to i/o port 7.<br><br>
stepper motor is electric motor that can be precisely controlled by
signals from a computer.<br><br>
the motor turns through a precise angle each time it receives a signal.<br><br>
by varying the rate at which signal pulses are produced,
the motor can be run at different speeds or turned through
an exact angle and then stopped.<br><br>

This is a basic 3-phase stepper motor, it has 3 magnets controlled by bits <b>0, 1 and 2</b>.
other bits (3..7) are unused.
<br><br>

When magnet is working it becomes red. The arrow in the left upper corner shows
the direction of the last motor move. Green line is here just to see that it is
really rotating.

<br><br>

<img src="img/stepper.gif" width="237" height="215">

<br><br>

For example, the code below will do three clock-wise half-steps:<br><br>
<font face="Fixedsys">
MOV AL, 001b   ; initialize.<br>
OUT 7, AL<br><br>

MOV AL, 011b   ; half step 1.<br>
OUT 7, AL<br><br>

MOV AL, 010b   ; half step 2.<br>
OUT 7, AL<br><br>

MOV AL, 110b   ; half step 3.<br>
OUT 7, AL<br><br>
</font>

If you ever played with magnets you will understand how it works.
try experimenting, or see <b>stepper_motor.asm</b> in c:\emu8086\examples.

<br><br>
If required you can read the data from port using <b>IN</b> instruction, for example:<br>
<br>
<font face="Fixedsys">
IN AL, 7<br><br>
</font>

Stepper motor sets topmost bit of byte value in port 7 when it's ready.

<hr>

<br><br>

</li>


<li><b>Robot</b> - port 9 (3 bytes)<br><br>


<img src="img/robot.gif" width="530" height="352">

<br><br>
The robot is controlled by sending data to i/o port 9.<br>
<br><br>

The first byte (port 9) is a <b>command register</b>. set values to
this port to make robot do something. supported values:<br><br>
<table border="1" cellpadding="7">
<tr>
<td bgcolor="yellow">decimal value</td><td bgcolor="yellow">binary value</td><td bgcolor="yellow">action</td>
</tr>
<tr>
<td align="center" valign="center"><b>0</b> </td> <td>00000000</td> <td> do nothing.</td>
</tr>
<td align="center" valign="center"><b>1</b> </td> <td>00000001</td> <td> move forward.</td>

<tr>
<td align="center" valign="center"><b>2</b> </td> <td>00000010</td> <td> turn left.</td>
</tr>
<tr>
<td align="center" valign="center"><b>3</b> </td> <td>00000011</td> <td> turn right.</td>
</tr>
<tr>
<td align="center" valign="center"><b>4</b> </td> <td>00000100</td> <td>examine.
           examines an object in front using sensor. when robot completes the task,
           result is set to <b>data register</b> and <b>bit #0</b> of <b>status register</b>
           is set to <b>1</b>.</td>
</tr>

<tr>
<td align="center" valign="center"><b>5</b> </td> <td>00000101</td> <td> switch on a lamp.</td>
</tr>

<tr>
<td align="center" valign="center"><b>6</b> </td> <td>00000110</td> <td> switch off a lamp.</td>
</tr>

</table>

<br><br>

The second byte (port 10) is a <b>data register</b>. this register
is set after robot completes the <b>examine</b> command:<br><br>

<table border="1" cellpadding="7">
<tr>
<td bgcolor="yellow">decimal value</td><td bgcolor="yellow">binary value</td><td bgcolor="yellow">meaning</td>
</tr>
<tr>
<td align="center" valign="center"><b>255</b></td>  <td>11111111</td> <td>wall</td>
</tr>
<tr>
<td align="center" valign="center"><b>0</b></td>  <td>00000000</td> <td>nothing</td>
</tr>
<tr>
<td align="center" valign="center"><b>7</b></td>  <td>00000111</td> <td>switched-on lamp</td>
</tr>
<tr>
<td align="center" valign="center"><b>8</b></td>  <td>00001000</td> <td>switched-off lamp</td>
</tr>
</table>

<br><br>

The third byte (port 11) is a <b>status register</b>. read values from
this port to determine the state of the robot. each bit has
a specific property:<br><br>
<table border="1" cellpadding="7">
<tr>
<td bgcolor="yellow"><nobr>bit number</nobr></td><td bgcolor="yellow">description</td>
</tr>
<tr>
<td><b>bit #0 </b> </td><td>  <b>zero</b> when there is no new data in <b>data register</b>,
             <b>one</b> when there is new data in <b>data register</b>.</td>
</tr>
<tr>
<td><b>bit #1 </b> </td><td>  <b>zero</b> when robot is ready for next command,
      <b>one</b> when robot is busy doing some task.</td>
</tr>
<tr>
<td><b>bit #2 </b> </td><td>  <b>zero</b> when there is no error on last command execution,
           <b>one</b> when there is an error on command execution (when robot cannot
           complete the task: move, turn, examine, switch on/off lamp).</td>
</tr>
</table>

<br><br>

example:<br>
<pre><font face="Fixedsys">
MOV AL, 1  ; move forward.
OUT 9, AL  ;

MOV AL, 3  ; turn right.
OUT 9, AL  ;

MOV AL, 1  ; move forward.
OUT 9, AL  ;

MOV AL, 2  ; turn left.
OUT 9, AL  ;

MOV AL, 1  ; move forward.
OUT 9, AL  ;
</font></pre>

<br>

keep in mind that robot is a
mechanical creature and it takes
some time for it to complete
a task. you should always check bit#1 of <b>status register</b>
before sending data to port 9, otherwise
the robot will reject your command and "<font color="red"><b>busy!</b></font>" will be
shown. see <b>robot.asm</b> in c:\emu8086\examples.


<br><br>

<hr>

<br>


<b>Creating Custom Robo-World Map</b>

<br><br>

It is possible to change the default map for the robot using the tool box.<br><br>
if you click the robot button and place robot over existing robot it
will turn 90 degrees counter-clock-wise. to manually move the robot
just place it anywhere else on the map.<br><br>

If you click lamp button and click switched-on lamp
the lamp will be switched-off, if lamp is
already switched-off it will be deleted.
click over empty space will create a new switched-on lamp. <br><br>

Placing wall over existing wall deletes the wall.
<br><br>

Current version is limited to a single robot only. if you forget to place
a robot on the map it will be placed in some random coordinates.

<br><br>
When robot device is closed the map is automatically saved inside this file: <nobr><b>c:\emu8086\devices\robot_map.dat</b></nobr>
<br>
It is possible to have several maps by renaming and coping this file before starting the robot device.

<br><br>
The right-click over the map brings up a popup menu that allows to switch-on or switch-off all the lamps at once.
<br><br>

<hr>

</li>


</ul>






<br><br>


For a list of frequently asked questions click <a href="http://www.emu8086.com/dr/emu8086_assembler_solutions_faq.html" target="_blank" rel="noopener"><b><u>here</u></b></a>.
<br><br>



</font>


<!--- eof --><!-- hexo-inject:begin --><!-- hexo-inject:end -->


<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300,"vOffset":-30},"mobile":{"show":false,"scale":0.3,"display":{"position":"right","width":20,"height":40,"vOffset":-10}},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>

        
      </div>
      
      
      
    </div>
    


  
  
  <ul class="breadcrumb">
    
      
      
        
          <li><a href="/ustc-cs/">USTC-CS</a></li>
          
            
          
        
      
    
      
      
        
          <li><a href="/ustc-cs/计算机与信息类/">计算机与信息类</a></li>
          
            
          
        
      
    
      
      
        
          <li><a href="/ustc-cs/计算机与信息类/微机原理与系统/">微机原理与系统</a></li>
          
            
          
        
      
    
      
      
        
          <li><a href="/ustc-cs/计算机与信息类/微机原理与系统/lab/">LAB</a></li>
          
            
          
        
      
    
      
      
        
          <li><a href="/ustc-cs/计算机与信息类/微机原理与系统/lab/emu8086/">EMU8086</a></li>
          
            
          
        
      
    
      
      
        
          <li>DOCUMENTATION</li>
        
      
    
      
      
        
          <li><a href="/ustc-cs/计算机与信息类/微机原理与系统/lab/emu8086/io.html/">IO.HTML</a></li>
          
            
          
        
      
    
  </ul>


    
    
    
  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zMDA5Ni82NjUx"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/yinyang.png"
                alt="mbinary" />
            
              <p class="site-author-name" itemprop="name">mbinary</p>
              <p class="site-description motion-element" itemprop="description">淡泊明志, 宁静致远</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">39</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">47</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/mbinary" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="http://www.linkedin.com/in/cs-heqin-zhu" target="_blank" title="LinkedIn" rel="external nofollow"><i class="fa fa-fw fa-linkedin"></i>LinkedIn</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://leetcode-cn.com/mbinary/" target="_blank" title="Leetcode" rel="external nofollow"><i class="fa fa-fw fa-code"></i>Leetcode</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.jianshu.com/u/a3bef26d9911" target="_blank" title="Jianshu" rel="external nofollow"><i class="fa fa-fw fa-pencil"></i>Jianshu</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="http://wpa.qq.com/msgrd?v=3&uin=414313516&site=qq&menu=yes" target="_blank" title="QQ" rel="external nofollow"><i class="fa fa-fw fa-qq"></i>QQ</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:zhuheqin1@gmail.com" target="_blank" title="Email" rel="external nofollow"><i class="fa fa-fw fa-envelope"></i>Email</a>
                  
                </span>
              
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://mbinary.coding.me/photo/index.html" title="相册" target="_blank">相册</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://mbinary.coding.me/share-books.html" title="书籍" target="_blank">书籍</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://mbinary.coding.me/video.html" title="影视" target="_blank">影视</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://mbinary.coding.me/share/blogs.html" title="博客" target="_blank">博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://mbinary.coding.me/share/tools.html" title="工具" target="_blank">工具</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </section>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div>
  <span class="with-love">
    <a href="https://github.com/mbinary"><i class="fa fa-github"></i></a>
    <a href="mailto:zhuheqin1@gmail.com?subject=feedback"><i class="fa fa-envelope"></i></a>
    <a href="http://wpa.qq.com/msgrd?v=3&uin=414313516&site=qq&menu=yes"><i class="fa fa-qq"></i></a>
    <a href="https://mbinary.coding.me/atom.xml"><i class="fa fa-feed"></i>
        <span class="with-love" id="heart">(。・∀・)ノ<i class="fa fa-heart"></i></span></a>
</span></div>
<div> 
  <span>
      Host: 
      <a class="host" href="https://mbinary.github.io"><i class="fa fa-github-alt"></i>Github</a>
      <a class="host" href="https://mbinary.coding.me"><i class="fa fa-code"></i>Coding</a>
  </span>
</div>
<div class="copyright">
  <span>
      <a class="theme-link" rel="external nofolow" href="https://hexo.io/themes/index.html">Hexo </a> 
      Theme:
      <a href="https://github.com/theme-next/hexo-theme-next">Next</a>
  </span>
  &nbsp;
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2018</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="https://ajax.cat.net/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.2"></script>



  



  
    <script type="text/javascript">
      window.livereOptions = {
        refer: 'ustc-cs/计算机与信息类/微机原理与系统/lab/emu8086/documentation/io.html'
      };
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  

  


  
  

  
  
  
    
  
  <script src="https://cdn.jsdelivr.net/npm/pangu@3.3.0/dist/browser/pangu.min.js"></script>
  <script type="text/javascript">pangu.spacingPage();</script>


  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=6.4.2"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=6.4.2"></script>


  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('复制')
        }, 300)
      }).append(e)
    })
  </script>


<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300,"vOffset":-30},"mobile":{"show":false,"scale":0.3,"display":{"position":"right","width":20,"height":40,"vOffset":-10}},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
